<div class="costs-and-resources-analysis">
  <md-toolbar>
    <div class="md-toolbar-tools">
      <h3>
        Analyse Costs and Resources for a Project
      </h3>
    </div>
  </md-toolbar>

  <loading-indicator loading="$ctrl.loading"></loading-indicator>

  <md-content layout-padding>

    <div flex-sm="100" flex-gt-sm="90" flex-gt-md="70" flex-gt-lg="50" class="md-whiteframe-z1" layout-padding>
      <md-content>

        <md-input-container class="md-block">
          <label for="project">Project</label>
          <md-select
            name="project"
            ng-model="$ctrl.selectedProject"
            ng-disabled="!$ctrl.Projects.all.length"
            required>
            <md-option
              ng-repeat="p in $ctrl.Projects.all"
              ng-value="p">
              {{p.shortname}}
              ({{p.name}})
            </md-option>
          </md-select>
        </md-input-container>

        <md-input-container class="md-block">
          <label for="billing_file">Billing source data</label>
          <md-select
            name="billing_file"
            ng-model="$ctrl.selectedBillingFile"
            required
            ng-disabled="$ctrl.loading">
            <md-option ng-repeat="f in $ctrl.availableBillingFiles" ng-value="f">
              {{f}}
            </md-option>
          </md-select>
        </md-input-container>

        <md-input-container class="md-block">
          <label for="metrics_file">Metrics source data</label>
          <md-select
            name="metrics_file"
            ng-model="$ctrl.selectedMetricsFile"
            required
            ng-disabled="$ctrl.loading">
            <md-option ng-repeat="f in $ctrl.availableMetricsFiles" ng-value="f">
              {{f}}
            </md-option>
          </md-select>
        </md-input-container>

        <div layout="row" layout-align="center center">
          <md-button
            class="md-primary md-raised"
            ng-click="$ctrl.analyse()"
            ng-disabled="$ctrl.loading || !$ctrl.isReadyToAnalyse()">
            Analyse
          </md-button>
        </div>

        <br />
        <md-divider ng-if="$ctrl.data"></md-divider>
        <br />

        <md-card ng-repeat="(clusterName, c) in $ctrl.data track by clusterName">
          <md-card-title>
            <md-card-title-text>
              <span class="md-headline">
                Cluster: {{clusterName}}
              </span>
            </md-card-title-text>
          </md-card-title>

          <md-card-content>
            <p class="md-body-1">
              <span md-colors="{color: 'blue-grey-700'}">
                AWS account ID:
              </span>
              {{c.account_id}}
            </p>

            <p class="md-body-1">
              <span md-colors="{color: 'blue-grey-700'}">
                AWS account name:
              </span>
              {{c.account_name}}
            </p>

            <p class="md-body-1">
              <span md-colors="{color: 'blue-grey-700'}">
                Total cost of cluster:
              </span>
              <strong md-colors="{color: 'accent'}">{{c.cluster_bills.total | currency:'$'}}</strong>
            </p>

            <br />
            <md-divider></md-divider>
            <br />

            <h4 class="text-center">Namespaces usage breakdown</h4>

            <nvd3 options="$ctrl.namespacesUsageChartOptions" data="$ctrl.charts.namespacesUsage[clusterName]"></nvd3>
          </md-card-content>
        </md-card>

      </md-content>
    </div>

  </md-content>
</div>
